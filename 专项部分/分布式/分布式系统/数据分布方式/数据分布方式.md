# 数据分布方式

## hash方式

![img](https://cdn.nlark.com/yuque/0/2020/png/1474620/1590551699706-f2b4e66e-394c-47f4-bd0a-3038798a69b6.png)

### 优点：

```
只要设计好的数据散列函数，就能将数据均匀的分散到  各个节点上
```

### 缺点：

```
扩容时需要迁移大量数据，改进方法： 将数据分多片，然后交给中心服务器进行管理，扩容时只需要中心服务器进行调度；
```

## 数据范围方式（redis使用）： 

```
	数据进行划分范围，中心管理器进行调度管理扩容和缩容
```

### 优点：

```
中心调度器进行管理扩容和缩容方便，
```

### 缺点:

```
需要维护较为复杂的元数据信息。随着集群规模扩大，元数据服务容易成为性能瓶颈，此时需要多元数据服务机制
```





## 一致性hash：

![img](https://cdn.nlark.com/yuque/0/2020/png/1474620/1590551743473-0fd09fe8-cf29-4832-bbda-c24985132744.png)



```
一致性哈希最初在 P2P 网络中作为分布式哈希表（DHT）的常用数据分布算法。一致性哈希的基本方式是使用一个哈希函数计算数据或数据特征的哈希值，令该哈希函数的输出值域为一个封闭的环，即哈希函数输出的最大值是最小值的前序。将节点随机分布到这个环上，每个节点负责处理从自己开始顺时针至下一个节点的全部哈希值域上的数据
例如，某一哈希函数的值域为 [0,8)，系统有3个节点A、B、C，分别处于一致性哈希的位置为1,3,6，则A负责 [1,3)的数据，B负责 [3,6)的数据，C负责 [6,8)的数据
```

### 优点：

* 当删除或者增加一个节点时，不会出现惊群，只会影响到前后两个节点。

  







![img](https://pic4.zhimg.com/80/v2-0ce62cf40bcc5f980cafe285dafe0633_720w.jpg)

## 设置虚拟节点-解决节点较少的问题： 

```
避免数据分配不均匀，增加一张真实节点和虚拟节点的映射表
随机分布哈希值域的方式，很难均匀地分布哈希值域，即使均匀分布了，在动态添加或删除一个节点后又会导致不均匀。由此引出一个更严重的问题，当一个节点异常时，压力将直接分摊到相邻的节点，很有肯能连锁崩溃。加入一个新节点只能为相邻节点分摊压力。改进方法：引入“虚节点”。系统创建时即建立很多虚节点，虚节点的个数远大于未来集群中估计的机器的最大个数，一般百倍量级。将虚节点均匀的分布到一致性哈希换上，其功能与一致性哈希算法的节点相同，为每个节点分配多个虚节点。操作数据时，通过数据的哈希值在环上找到对应的虚节点，进而查找元数据找到对应的真实节点。使用虚节点可以使得：当一个节点异常时，会使多个相关的虚节点失效，从而使多个相邻的真实节点负载异常节点的压力。同理，一旦加入一个新节点，可以分配多个虚节点，使得新节点能够负载多个节点的压力。较容易实现扩容时的负载均衡
```



![img](https://pic1.zhimg.com/80/v2-5d9cdea01cb4b44162aa41980345e8ac_720w.jpg)



