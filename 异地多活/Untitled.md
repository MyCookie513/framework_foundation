



## 背景：

> 同城双活为了避免双机房写可能会产生冲突，所以呢设置了单机房写,读依赖数据同步
>
> 但是在异地多活的场景下，单写，读依赖数据同步到方式，时延太大，不能满足业务需求
>
> 所以只能双写
>
> 1. 双写会可能产生数据冲突
> 2. 读可能会较大延时
>
> 优化思路就是：在业务上进行流量分离，在每个IDC内读写闭环。<mark> 相当于绕过了双写</mark>

所以我们聚焦到流量划分这里：

有三个主体流量，分别划分：

<mark> 乘客 司机 订单 </mark>

#### 担心问题：

> 尽可能按照靠近机房划分（本身我们也是地域相关的业务）
>
> 根据公司本身的业务逻辑，地域上就近划分流量是最合理的方式。那我们首先提出根据实时位置划分机房。同时面临一个问题
>
> 我们在肯定都在担心划分流量的地域边界，这样会导致一会在机房A，一会在机房B

目标是两点：

* 符合地域属性
* 固定机房

### 划分思路：

1. 乘客： 操作比较少且对于乘客这个对象的操作，我们没有做异地多活；所以直接按照实时位置进行划分流量就可以
2. 司机： 写操作比较多， 而且为异地多活重点对象，所以结合地域划分以及流量边界的综合考虑，根据司机注册地进行流量划分；
3. 订单：订单在设立之初就有符合地域属性的标识，相关操作均固定在这个标识映射的IDC，同时满足了 地域相关，机房固定的特性；











